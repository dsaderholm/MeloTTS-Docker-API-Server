# MeloTTS Production Deployment with Intel Arc GPU\n\nThis production-ready setup uses Intel's official IPEX-LLM Docker image for proven Intel Arc GPU compatibility.\n\n## üèóÔ∏è Architecture\n\n- **Base Image**: `intelanalytics/ipex-llm-xpu:2.1.0-SNAPSHOT` (Intel's official image)\n- **GPU Support**: Full Intel Arc A380 hardware acceleration via PyTorch XPU\n- **Production Features**: Health checks, resource limits, restart policies\n- **Environment**: Optimized for production workloads\n\n## ‚úÖ Key Advantages\n\n1. **Proven Compatibility**: Uses Intel's tested container stack\n2. **No Driver Conflicts**: All Intel Arc drivers pre-installed and configured\n3. **Production Ready**: Health checks, logging, error handling\n4. **Performance Optimized**: Intel-tuned environment variables\n5. **Resource Management**: Memory limits and GPU affinity settings\n\n## üöÄ Quick Start\n\n### 1. Build Production Container\n```bash\ncd /path/to/MeloTTS-Docker-API-Server\ndocker-compose -f docker-compose.production.yml build\n```\n\n### 2. Deploy\n```bash\ndocker-compose -f docker-compose.production.yml up -d\n```\n\n### 3. Monitor\n```bash\n# Check health\ndocker-compose -f docker-compose.production.yml ps\n\n# View logs\ndocker-compose -f docker-compose.production.yml logs -f\n\n# Check GPU usage\nintel_gpu_top\n```\n\n## üß™ Testing\n\n### Health Check\n```bash\ncurl http://localhost:8888/health\n```\n\n### GPU Verification\n```bash\n# Inside container\ndocker exec -it melotts-server-production sycl-ls\n\n# Should show Intel Arc A380\n```\n\n### TTS Test\n```bash\ncurl -X POST \"http://localhost:8888/convert/tts\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"text\": \"Hello from Intel Arc GPU accelerated MeloTTS!\",\n    \"speed\": 1.0,\n    \"language\": \"EN\",\n    \"speaker_id\": \"EN-Default\"\n  }' \\\n  --output test_output.wav\n```\n\n## üìä Performance Monitoring\n\n### GPU Usage\n```bash\n# Real-time GPU monitoring\nintel_gpu_top\n\n# Container stats\ndocker stats melotts-server-production\n```\n\n### Application Metrics\n```bash\n# Health endpoint provides detailed info\ncurl http://localhost:8888/health | jq\n```\n\n**Expected Response:**\n```json\n{\n  \"status\": \"healthy\",\n  \"device\": \"xpu\",\n  \"intel_gpu_available\": true,\n  \"intel_gpu_name\": \"Intel(R) Arc(TM) A380 Graphics\",\n  \"ipex_loaded\": true,\n  \"torch_version\": \"2.1.0+xpu\",\n  \"models_cached\": 1,\n  \"gpu_init_success\": true\n}\n```\n\n## üîß Configuration\n\n### Environment Variables\n```yaml\n# Performance optimization\nONEAPI_DEVICE_SELECTOR: level_zero:0    # Use primary Arc GPU\nZE_AFFINITY_MASK: 0                     # GPU affinity\nSYCL_CACHE_PERSISTENT: 1                # Enable cache\nSYCL_PI_LEVEL_ZERO_USE_IMMEDIATE_COMMANDLISTS: 1  # Performance\n\n# Application settings\nDEFAULT_SPEED: 1.0\nDEFAULT_LANGUAGE: EN\nDEFAULT_SPEAKER_ID: EN-Default\n```\n\n### Resource Limits\n```yaml\nmem_limit: 8g        # Prevent memory exhaustion\nshm_size: 2g         # Shared memory for GPU\ndevices:\n  - /dev/dri:/dev/dri  # GPU device passthrough\n```\n\n## üõ†Ô∏è Troubleshooting\n\n### Container Won't Start\n```bash\n# Check logs\ndocker-compose -f docker-compose.production.yml logs\n\n# Verify GPU devices\nls -la /dev/dri/\n\n# Check host drivers\nvainfo\n```\n\n### GPU Not Detected\n```bash\n# Inside container\ndocker exec -it melotts-server-production bash\nsycl-ls  # Should show Arc A380\n\n# If not visible, check device mapping\ndocker exec -it melotts-server-production ls -la /dev/dri/\n```\n\n### Performance Issues\n```bash\n# Monitor GPU usage during TTS\nintel_gpu_top &\ncurl -X POST \"http://localhost:8888/convert/tts\" -H \"Content-Type: application/json\" -d '{\"text\":\"Test performance\"}'\n\n# Check if GPU is being used (should show Video/Compute activity)\n```\n\n### Memory Issues\n```bash\n# Check container memory usage\ndocker stats melotts-server-production\n\n# Increase memory limit if needed\n# Edit docker-compose.production.yml -> mem_limit: 16g\n```\n\n## üîÑ Updates\n\n### Update to Latest IPEX-LLM\n```bash\n# Edit Dockerfile.production\n# Change: FROM intelanalytics/ipex-llm-xpu:2.1.0-SNAPSHOT\n# To:     FROM intelanalytics/ipex-llm-xpu:latest\n\n# Rebuild\ndocker-compose -f docker-compose.production.yml build --no-cache\ndocker-compose -f docker-compose.production.yml up -d\n```\n\n## üè≠ Production Checklist\n\n- ‚úÖ **Base Image**: Uses Intel's official IPEX-LLM image\n- ‚úÖ **Health Checks**: HTTP endpoint monitoring\n- ‚úÖ **Resource Limits**: Memory and GPU constraints\n- ‚úÖ **Restart Policy**: Automatic restart on failure\n- ‚úÖ **Logging**: Structured logging with levels\n- ‚úÖ **Error Handling**: Graceful fallback to CPU\n- ‚úÖ **Performance**: Intel Arc GPU optimization\n- ‚úÖ **Monitoring**: GPU usage and application metrics\n\n## üÜö vs. Previous Approach\n\n| Feature | Previous | Production |\n|---------|----------|------------|\n| Base Image | python:3.9 | intelanalytics/ipex-llm-xpu |\n| GPU Drivers | Manual install | Pre-configured |\n| Intel Arc Support | Experimental | Production-tested |\n| Resource Management | None | Limits + monitoring |\n| Health Checks | None | Built-in |\n| Error Handling | Basic | Production-grade |\n| Performance | Variable | Optimized |\n\nThis production setup eliminates the driver installation issues and provides a stable, performant Intel Arc GPU-accelerated MeloTTS service."